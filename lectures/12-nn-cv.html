
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>데모 &#8212; 단국대 2020 캐글 뽀개기</title>
    
  <link rel="stylesheet" href="../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../_static/logo.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="데모" href="13-lr-tfidf.html" />
    <link rel="prev" title="범주형변수 가공 데모" href="11-categorical-features.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">단국대 2020 캐글 뽀개기</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../main.html">
   단국대 2020년 가을학기 캐글 뽀개기 강좌
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="01-intro.html">
   1장. Intro
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03-pandas-eda.html">
   3장. Pandas
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04-numpy-lr.html">
   4장. Numpy, 선형회귀, 로지스틱회귀
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05-numerical-features.html">
   5장. 수치형변수 가공
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06-decision-trees.html">
   6장. Scikit-learn, 결정트리
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="07-lightgbm.html">
   7장. Random Forest, GBM (1)
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="07-rf.html">
     7장. Random Forest, GBM (2)
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="08-lightgbm-cv.html">
   8장. Cross-Validation, Stacking (1)
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="08-lr-cv.html">
     8장. Cross-Validation, Stacking (2)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-rf-cv.html">
     8장. Cross-Validation, Stacking (3)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-stacking-lgb.html">
     8장. Cross-Validation, Stacking (4)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-stacking-lr.html">
     8장. Cross-Validation, Stacking (5)
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="09-lightgbm-hyperopt.html">
   9장. 모델 튜닝, Hyperopt, Optuna (1)
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="09-lightgbm-optuna.html">
     9장. 모델 튜닝, Hyperopt, Optuna (2)
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="11-categorical-features.html">
   11장. 범주형변수
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   12장. 신경망, Keras
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="13-lr-tfidf.html">
   13장. 문자열변수 가공
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="14-cnn-emb.html">
   14장. Embedding, RNN (1)
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="14-lstm-emb.html">
     14장. Embedding, RNN (2)
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="15-bert.html">
   15장. 선학습 임베딩, 전이학습 (1)
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="15-lstm-glove.html">
     15장. 선학습 임베딩, 전이학습 (2)
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="16-attention.html">
   16장. Data Augmentation
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/lectures/12-nn-cv.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/SDSTony/dku-kaggle-class"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/SDSTony/dku-kaggle-class/issues/new?title=Issue%20on%20page%20%2Flectures/12-nn-cv.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/SDSTony/dku-kaggle-class/master?urlpath=tree/lectures/12-nn-cv.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#import">
   라이브러리 import 및 설정
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   학습데이터 로드
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#polynomial-feature">
   Polynomial Feature 생성
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#stratified-k-fold-cross-validation">
   Stratified K-Fold Cross Validation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#keras-model">
   Keras Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sequential-api">
     Sequential API
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#functional-api">
     Functional API
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id3">
   신경망 모델 학습
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id4">
   신경망 모델 시각화
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id5">
   제출 파일 생성
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="id1">
<h1>데모<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="import">
<h2>라이브러리 import 및 설정<a class="headerlink" href="#import" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">reload_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rcParams</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">StratifiedKFold</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">PolynomialFeatures</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras</span> <span class="kn">import</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Model</span><span class="p">,</span> <span class="n">Sequential</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span><span class="p">,</span> <span class="n">ReduceLROnPlateau</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.utils</span> <span class="kn">import</span> <span class="n">plot_model</span><span class="p">,</span> <span class="n">to_categorical</span>
<span class="kn">import</span> <span class="nn">warnings</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;fivethirtyeight&#39;</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;max_columns&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.precision&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id2">
<h2>학습데이터 로드<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/kaggler-tv/dku-kaggle-class/blob/master/notebook/03-pandas-eda.ipynb">03-pandas-eda.ipynb</a>에서 생성한 <code class="docutils literal notranslate"><span class="pre">feature.csv</span></code> 피처파일 사용</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;../data/dacon-dku&#39;</span><span class="p">)</span>
<span class="n">feature_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;../build/feature&#39;</span><span class="p">)</span>
<span class="n">val_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;../build/val&#39;</span><span class="p">)</span>
<span class="n">tst_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;../build/tst&#39;</span><span class="p">)</span>
<span class="n">sub_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;../build/sub&#39;</span><span class="p">)</span>

<span class="n">trn_file</span> <span class="o">=</span> <span class="n">data_dir</span> <span class="o">/</span> <span class="s1">&#39;train.csv&#39;</span>
<span class="n">tst_file</span> <span class="o">=</span> <span class="n">data_dir</span> <span class="o">/</span> <span class="s1">&#39;test.csv&#39;</span>
<span class="n">sample_file</span> <span class="o">=</span> <span class="n">data_dir</span> <span class="o">/</span> <span class="s1">&#39;sample_submission.csv&#39;</span>

<span class="n">target_col</span> <span class="o">=</span> <span class="s1">&#39;class&#39;</span>
<span class="n">n_fold</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">n_class</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">seed</span> <span class="o">=</span> <span class="mi">42</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">algo_name</span> <span class="o">=</span> <span class="s1">&#39;nncv&#39;</span>
<span class="n">feature_name</span> <span class="o">=</span> <span class="s1">&#39;polyfeature&#39;</span>
<span class="n">model_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">algo_name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">feature_name</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="n">feature_file</span> <span class="o">=</span> <span class="n">feature_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">feature_name</span><span class="si">}</span><span class="s1">.csv&#39;</span>
<span class="n">p_val_file</span> <span class="o">=</span> <span class="n">val_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s1">.val.csv&#39;</span>
<span class="n">p_tst_file</span> <span class="o">=</span> <span class="n">tst_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s1">.tst.csv&#39;</span>
<span class="n">sub_file</span> <span class="o">=</span> <span class="n">sub_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s1">.csv&#39;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="polynomial-feature">
<h2>Polynomial Feature 생성<a class="headerlink" href="#polynomial-feature" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">feature_dir</span> <span class="o">/</span> <span class="s1">&#39;feature.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(400000, 20)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>z</th>
      <th>redshift</th>
      <th>dered_u</th>
      <th>dered_g</th>
      <th>dered_r</th>
      <th>dered_i</th>
      <th>dered_z</th>
      <th>nObserve</th>
      <th>airmass_u</th>
      <th>class</th>
      <th>d_dered_u</th>
      <th>d_dered_g</th>
      <th>d_dered_r</th>
      <th>d_dered_i</th>
      <th>d_dered_z</th>
      <th>d_dered_ig</th>
      <th>d_dered_zg</th>
      <th>d_dered_rz</th>
      <th>d_dered_iz</th>
      <th>d_obs_det</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>16.9396</td>
      <td>-8.1086e-05</td>
      <td>23.1243</td>
      <td>20.2578</td>
      <td>18.9551</td>
      <td>17.6321</td>
      <td>16.9089</td>
      <td>2.9444</td>
      <td>1.1898</td>
      <td>0.0</td>
      <td>-0.1397</td>
      <td>-0.0790</td>
      <td>-0.0544</td>
      <td>-0.0403</td>
      <td>-0.0307</td>
      <td>-2.6257</td>
      <td>-3.3488</td>
      <td>2.0462</td>
      <td>0.7232</td>
      <td>-15.0556</td>
    </tr>
    <tr>
      <th>1</th>
      <td>13.1689</td>
      <td>4.5061e-03</td>
      <td>14.9664</td>
      <td>14.0045</td>
      <td>13.4114</td>
      <td>13.2363</td>
      <td>13.1347</td>
      <td>0.6931</td>
      <td>1.2533</td>
      <td>1.0</td>
      <td>-0.0857</td>
      <td>-0.0574</td>
      <td>-0.0410</td>
      <td>-0.0322</td>
      <td>-0.0343</td>
      <td>-0.7683</td>
      <td>-0.8698</td>
      <td>0.2767</td>
      <td>0.1016</td>
      <td>-0.3069</td>
    </tr>
    <tr>
      <th>2</th>
      <td>15.3500</td>
      <td>4.7198e-04</td>
      <td>16.6076</td>
      <td>15.6866</td>
      <td>15.4400</td>
      <td>15.3217</td>
      <td>15.2961</td>
      <td>1.0986</td>
      <td>1.0225</td>
      <td>0.0</td>
      <td>-0.1787</td>
      <td>-0.1388</td>
      <td>-0.0963</td>
      <td>-0.0718</td>
      <td>-0.0540</td>
      <td>-0.3649</td>
      <td>-0.3905</td>
      <td>0.1440</td>
      <td>0.0257</td>
      <td>-0.9014</td>
    </tr>
    <tr>
      <th>3</th>
      <td>19.6346</td>
      <td>5.8143e-06</td>
      <td>25.3536</td>
      <td>20.9947</td>
      <td>20.0873</td>
      <td>19.7947</td>
      <td>19.5552</td>
      <td>1.6094</td>
      <td>1.2054</td>
      <td>0.0</td>
      <td>-0.3070</td>
      <td>-0.1941</td>
      <td>-0.1339</td>
      <td>-0.1003</td>
      <td>-0.0795</td>
      <td>-1.2000</td>
      <td>-1.4395</td>
      <td>0.5321</td>
      <td>0.2395</td>
      <td>-1.3906</td>
    </tr>
    <tr>
      <th>4</th>
      <td>17.9826</td>
      <td>-3.3247e-05</td>
      <td>23.7714</td>
      <td>20.4338</td>
      <td>18.8630</td>
      <td>18.1903</td>
      <td>17.8759</td>
      <td>2.6391</td>
      <td>1.1939</td>
      <td>0.0</td>
      <td>-0.6820</td>
      <td>-0.2653</td>
      <td>-0.1794</td>
      <td>-0.1339</td>
      <td>-0.1067</td>
      <td>-2.2436</td>
      <td>-2.5579</td>
      <td>0.9871</td>
      <td>0.3144</td>
      <td>-9.3609</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">poly</span> <span class="o">=</span> <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">target_col</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">feature_names</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">feature_names</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;1&#39;,
 &#39;z&#39;,
 &#39;redshift&#39;,
 &#39;dered_u&#39;,
 &#39;dered_g&#39;,
 &#39;dered_r&#39;,
 &#39;dered_i&#39;,
 &#39;dered_z&#39;,
 &#39;nObserve&#39;,
 &#39;airmass_u&#39;,
 &#39;class&#39;,
 &#39;d_dered_u&#39;,
 &#39;d_dered_g&#39;,
 &#39;d_dered_r&#39;,
 &#39;d_dered_i&#39;,
 &#39;d_dered_z&#39;,
 &#39;d_dered_ig&#39;,
 &#39;d_dered_zg&#39;,
 &#39;d_dered_rz&#39;,
 &#39;d_dered_iz&#39;,
 &#39;z^2&#39;,
 &#39;z redshift&#39;,
 &#39;z dered_u&#39;,
 &#39;z dered_g&#39;,
 &#39;z dered_r&#39;,
 &#39;z dered_i&#39;,
 &#39;z dered_z&#39;,
 &#39;z nObserve&#39;,
 &#39;z airmass_u&#39;,
 &#39;z class&#39;,
 &#39;z d_dered_u&#39;,
 &#39;z d_dered_g&#39;,
 &#39;z d_dered_r&#39;,
 &#39;z d_dered_i&#39;,
 &#39;z d_dered_z&#39;,
 &#39;z d_dered_ig&#39;,
 &#39;z d_dered_zg&#39;,
 &#39;z d_dered_rz&#39;,
 &#39;z d_dered_iz&#39;,
 &#39;redshift^2&#39;,
 &#39;redshift dered_u&#39;,
 &#39;redshift dered_g&#39;,
 &#39;redshift dered_r&#39;,
 &#39;redshift dered_i&#39;,
 &#39;redshift dered_z&#39;,
 &#39;redshift nObserve&#39;,
 &#39;redshift airmass_u&#39;,
 &#39;redshift class&#39;,
 &#39;redshift d_dered_u&#39;,
 &#39;redshift d_dered_g&#39;,
 &#39;redshift d_dered_r&#39;,
 &#39;redshift d_dered_i&#39;,
 &#39;redshift d_dered_z&#39;,
 &#39;redshift d_dered_ig&#39;,
 &#39;redshift d_dered_zg&#39;,
 &#39;redshift d_dered_rz&#39;,
 &#39;redshift d_dered_iz&#39;,
 &#39;dered_u^2&#39;,
 &#39;dered_u dered_g&#39;,
 &#39;dered_u dered_r&#39;,
 &#39;dered_u dered_i&#39;,
 &#39;dered_u dered_z&#39;,
 &#39;dered_u nObserve&#39;,
 &#39;dered_u airmass_u&#39;,
 &#39;dered_u class&#39;,
 &#39;dered_u d_dered_u&#39;,
 &#39;dered_u d_dered_g&#39;,
 &#39;dered_u d_dered_r&#39;,
 &#39;dered_u d_dered_i&#39;,
 &#39;dered_u d_dered_z&#39;,
 &#39;dered_u d_dered_ig&#39;,
 &#39;dered_u d_dered_zg&#39;,
 &#39;dered_u d_dered_rz&#39;,
 &#39;dered_u d_dered_iz&#39;,
 &#39;dered_g^2&#39;,
 &#39;dered_g dered_r&#39;,
 &#39;dered_g dered_i&#39;,
 &#39;dered_g dered_z&#39;,
 &#39;dered_g nObserve&#39;,
 &#39;dered_g airmass_u&#39;,
 &#39;dered_g class&#39;,
 &#39;dered_g d_dered_u&#39;,
 &#39;dered_g d_dered_g&#39;,
 &#39;dered_g d_dered_r&#39;,
 &#39;dered_g d_dered_i&#39;,
 &#39;dered_g d_dered_z&#39;,
 &#39;dered_g d_dered_ig&#39;,
 &#39;dered_g d_dered_zg&#39;,
 &#39;dered_g d_dered_rz&#39;,
 &#39;dered_g d_dered_iz&#39;,
 &#39;dered_r^2&#39;,
 &#39;dered_r dered_i&#39;,
 &#39;dered_r dered_z&#39;,
 &#39;dered_r nObserve&#39;,
 &#39;dered_r airmass_u&#39;,
 &#39;dered_r class&#39;,
 &#39;dered_r d_dered_u&#39;,
 &#39;dered_r d_dered_g&#39;,
 &#39;dered_r d_dered_r&#39;,
 &#39;dered_r d_dered_i&#39;,
 &#39;dered_r d_dered_z&#39;,
 &#39;dered_r d_dered_ig&#39;,
 &#39;dered_r d_dered_zg&#39;,
 &#39;dered_r d_dered_rz&#39;,
 &#39;dered_r d_dered_iz&#39;,
 &#39;dered_i^2&#39;,
 &#39;dered_i dered_z&#39;,
 &#39;dered_i nObserve&#39;,
 &#39;dered_i airmass_u&#39;,
 &#39;dered_i class&#39;,
 &#39;dered_i d_dered_u&#39;,
 &#39;dered_i d_dered_g&#39;,
 &#39;dered_i d_dered_r&#39;,
 &#39;dered_i d_dered_i&#39;,
 &#39;dered_i d_dered_z&#39;,
 &#39;dered_i d_dered_ig&#39;,
 &#39;dered_i d_dered_zg&#39;,
 &#39;dered_i d_dered_rz&#39;,
 &#39;dered_i d_dered_iz&#39;,
 &#39;dered_z^2&#39;,
 &#39;dered_z nObserve&#39;,
 &#39;dered_z airmass_u&#39;,
 &#39;dered_z class&#39;,
 &#39;dered_z d_dered_u&#39;,
 &#39;dered_z d_dered_g&#39;,
 &#39;dered_z d_dered_r&#39;,
 &#39;dered_z d_dered_i&#39;,
 &#39;dered_z d_dered_z&#39;,
 &#39;dered_z d_dered_ig&#39;,
 &#39;dered_z d_dered_zg&#39;,
 &#39;dered_z d_dered_rz&#39;,
 &#39;dered_z d_dered_iz&#39;,
 &#39;nObserve^2&#39;,
 &#39;nObserve airmass_u&#39;,
 &#39;nObserve class&#39;,
 &#39;nObserve d_dered_u&#39;,
 &#39;nObserve d_dered_g&#39;,
 &#39;nObserve d_dered_r&#39;,
 &#39;nObserve d_dered_i&#39;,
 &#39;nObserve d_dered_z&#39;,
 &#39;nObserve d_dered_ig&#39;,
 &#39;nObserve d_dered_zg&#39;,
 &#39;nObserve d_dered_rz&#39;,
 &#39;nObserve d_dered_iz&#39;,
 &#39;airmass_u^2&#39;,
 &#39;airmass_u class&#39;,
 &#39;airmass_u d_dered_u&#39;,
 &#39;airmass_u d_dered_g&#39;,
 &#39;airmass_u d_dered_r&#39;,
 &#39;airmass_u d_dered_i&#39;,
 &#39;airmass_u d_dered_z&#39;,
 &#39;airmass_u d_dered_ig&#39;,
 &#39;airmass_u d_dered_zg&#39;,
 &#39;airmass_u d_dered_rz&#39;,
 &#39;airmass_u d_dered_iz&#39;,
 &#39;class^2&#39;,
 &#39;class d_dered_u&#39;,
 &#39;class d_dered_g&#39;,
 &#39;class d_dered_r&#39;,
 &#39;class d_dered_i&#39;,
 &#39;class d_dered_z&#39;,
 &#39;class d_dered_ig&#39;,
 &#39;class d_dered_zg&#39;,
 &#39;class d_dered_rz&#39;,
 &#39;class d_dered_iz&#39;,
 &#39;d_dered_u^2&#39;,
 &#39;d_dered_u d_dered_g&#39;,
 &#39;d_dered_u d_dered_r&#39;,
 &#39;d_dered_u d_dered_i&#39;,
 &#39;d_dered_u d_dered_z&#39;,
 &#39;d_dered_u d_dered_ig&#39;,
 &#39;d_dered_u d_dered_zg&#39;,
 &#39;d_dered_u d_dered_rz&#39;,
 &#39;d_dered_u d_dered_iz&#39;,
 &#39;d_dered_g^2&#39;,
 &#39;d_dered_g d_dered_r&#39;,
 &#39;d_dered_g d_dered_i&#39;,
 &#39;d_dered_g d_dered_z&#39;,
 &#39;d_dered_g d_dered_ig&#39;,
 &#39;d_dered_g d_dered_zg&#39;,
 &#39;d_dered_g d_dered_rz&#39;,
 &#39;d_dered_g d_dered_iz&#39;,
 &#39;d_dered_r^2&#39;,
 &#39;d_dered_r d_dered_i&#39;,
 &#39;d_dered_r d_dered_z&#39;,
 &#39;d_dered_r d_dered_ig&#39;,
 &#39;d_dered_r d_dered_zg&#39;,
 &#39;d_dered_r d_dered_rz&#39;,
 &#39;d_dered_r d_dered_iz&#39;,
 &#39;d_dered_i^2&#39;,
 &#39;d_dered_i d_dered_z&#39;,
 &#39;d_dered_i d_dered_ig&#39;,
 &#39;d_dered_i d_dered_zg&#39;,
 &#39;d_dered_i d_dered_rz&#39;,
 &#39;d_dered_i d_dered_iz&#39;,
 &#39;d_dered_z^2&#39;,
 &#39;d_dered_z d_dered_ig&#39;,
 &#39;d_dered_z d_dered_zg&#39;,
 &#39;d_dered_z d_dered_rz&#39;,
 &#39;d_dered_z d_dered_iz&#39;,
 &#39;d_dered_ig^2&#39;,
 &#39;d_dered_ig d_dered_zg&#39;,
 &#39;d_dered_ig d_dered_rz&#39;,
 &#39;d_dered_ig d_dered_iz&#39;,
 &#39;d_dered_zg^2&#39;,
 &#39;d_dered_zg d_dered_rz&#39;,
 &#39;d_dered_zg d_dered_iz&#39;,
 &#39;d_dered_rz^2&#39;,
 &#39;d_dered_rz d_dered_iz&#39;,
 &#39;d_dered_iz^2&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_poly</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">feature_names</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">df_poly</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>
<span class="n">df_poly</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">df_poly</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">feature_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">del</span> <span class="n">df_poly</span><span class="p">,</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">feature_file</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(400000, 210)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1</th>
      <th>z</th>
      <th>redshift</th>
      <th>dered_u</th>
      <th>dered_g</th>
      <th>dered_r</th>
      <th>dered_i</th>
      <th>dered_z</th>
      <th>nObserve</th>
      <th>airmass_u</th>
      <th>class</th>
      <th>d_dered_u</th>
      <th>d_dered_g</th>
      <th>d_dered_r</th>
      <th>d_dered_i</th>
      <th>d_dered_z</th>
      <th>d_dered_ig</th>
      <th>d_dered_zg</th>
      <th>d_dered_rz</th>
      <th>d_dered_iz</th>
      <th>z^2</th>
      <th>z redshift</th>
      <th>z dered_u</th>
      <th>z dered_g</th>
      <th>z dered_r</th>
      <th>z dered_i</th>
      <th>z dered_z</th>
      <th>z nObserve</th>
      <th>z airmass_u</th>
      <th>z class</th>
      <th>z d_dered_u</th>
      <th>z d_dered_g</th>
      <th>z d_dered_r</th>
      <th>z d_dered_i</th>
      <th>z d_dered_z</th>
      <th>z d_dered_ig</th>
      <th>z d_dered_zg</th>
      <th>z d_dered_rz</th>
      <th>z d_dered_iz</th>
      <th>redshift^2</th>
      <th>redshift dered_u</th>
      <th>redshift dered_g</th>
      <th>redshift dered_r</th>
      <th>redshift dered_i</th>
      <th>redshift dered_z</th>
      <th>redshift nObserve</th>
      <th>redshift airmass_u</th>
      <th>redshift class</th>
      <th>redshift d_dered_u</th>
      <th>redshift d_dered_g</th>
      <th>...</th>
      <th>class d_dered_z</th>
      <th>class d_dered_ig</th>
      <th>class d_dered_zg</th>
      <th>class d_dered_rz</th>
      <th>class d_dered_iz</th>
      <th>d_dered_u^2</th>
      <th>d_dered_u d_dered_g</th>
      <th>d_dered_u d_dered_r</th>
      <th>d_dered_u d_dered_i</th>
      <th>d_dered_u d_dered_z</th>
      <th>d_dered_u d_dered_ig</th>
      <th>d_dered_u d_dered_zg</th>
      <th>d_dered_u d_dered_rz</th>
      <th>d_dered_u d_dered_iz</th>
      <th>d_dered_g^2</th>
      <th>d_dered_g d_dered_r</th>
      <th>d_dered_g d_dered_i</th>
      <th>d_dered_g d_dered_z</th>
      <th>d_dered_g d_dered_ig</th>
      <th>d_dered_g d_dered_zg</th>
      <th>d_dered_g d_dered_rz</th>
      <th>d_dered_g d_dered_iz</th>
      <th>d_dered_r^2</th>
      <th>d_dered_r d_dered_i</th>
      <th>d_dered_r d_dered_z</th>
      <th>d_dered_r d_dered_ig</th>
      <th>d_dered_r d_dered_zg</th>
      <th>d_dered_r d_dered_rz</th>
      <th>d_dered_r d_dered_iz</th>
      <th>d_dered_i^2</th>
      <th>d_dered_i d_dered_z</th>
      <th>d_dered_i d_dered_ig</th>
      <th>d_dered_i d_dered_zg</th>
      <th>d_dered_i d_dered_rz</th>
      <th>d_dered_i d_dered_iz</th>
      <th>d_dered_z^2</th>
      <th>d_dered_z d_dered_ig</th>
      <th>d_dered_z d_dered_zg</th>
      <th>d_dered_z d_dered_rz</th>
      <th>d_dered_z d_dered_iz</th>
      <th>d_dered_ig^2</th>
      <th>d_dered_ig d_dered_zg</th>
      <th>d_dered_ig d_dered_rz</th>
      <th>d_dered_ig d_dered_iz</th>
      <th>d_dered_zg^2</th>
      <th>d_dered_zg d_dered_rz</th>
      <th>d_dered_zg d_dered_iz</th>
      <th>d_dered_rz^2</th>
      <th>d_dered_rz d_dered_iz</th>
      <th>d_dered_iz^2</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>0.0002</td>
      <td>-0.1093</td>
      <td>1.8170</td>
      <td>0.1270</td>
      <td>0.9086</td>
      <td>0.0208</td>
      <td>0.0011</td>
      <td>1.6087</td>
      <td>0.1200</td>
      <td>0.0</td>
      <td>0.0063</td>
      <td>0.1783</td>
      <td>-0.0002</td>
      <td>0.0008</td>
      <td>-0.0981</td>
      <td>-0.0626</td>
      <td>0.0367</td>
      <td>0.0156</td>
      <td>-1.3511</td>
      <td>3.4181e-08</td>
      <td>-2.0203e-05</td>
      <td>0.0003</td>
      <td>2.3488e-05</td>
      <td>0.0002</td>
      <td>3.8455e-06</td>
      <td>2.0594e-07</td>
      <td>0.0003</td>
      <td>2.2191e-05</td>
      <td>2.2235e-05</td>
      <td>1.1669e-06</td>
      <td>3.2960e-05</td>
      <td>-3.7490e-08</td>
      <td>1.4942e-07</td>
      <td>-1.8144e-05</td>
      <td>-1.1575e-05</td>
      <td>6.7832e-06</td>
      <td>2.8794e-06</td>
      <td>-0.0002</td>
      <td>0.0119</td>
      <td>-0.1986</td>
      <td>-0.0139</td>
      <td>-0.0993</td>
      <td>-0.0023</td>
      <td>-0.0001</td>
      <td>-0.1758</td>
      <td>-0.0131</td>
      <td>-0.0131</td>
      <td>-0.0007</td>
      <td>-0.0195</td>
      <td>...</td>
      <td>-0.0118</td>
      <td>-0.0075</td>
      <td>0.0044</td>
      <td>0.0019</td>
      <td>-0.1625</td>
      <td>3.9834e-05</td>
      <td>1.1252e-03</td>
      <td>-1.2798e-06</td>
      <td>5.1009e-06</td>
      <td>-6.1941e-04</td>
      <td>-3.9513e-04</td>
      <td>2.3156e-04</td>
      <td>9.8297e-05</td>
      <td>-0.0085</td>
      <td>0.0318</td>
      <td>-3.6150e-05</td>
      <td>1.4408e-04</td>
      <td>-0.0175</td>
      <td>-1.1161e-02</td>
      <td>0.0065</td>
      <td>2.7766e-03</td>
      <td>-0.2409</td>
      <td>4.1119e-08</td>
      <td>-1.6389e-07</td>
      <td>1.9901e-05</td>
      <td>1.2695e-05</td>
      <td>-7.4398e-06</td>
      <td>-3.1582e-06</td>
      <td>2.7398e-04</td>
      <td>6.5318e-07</td>
      <td>-7.9317e-05</td>
      <td>-5.0598e-05</td>
      <td>2.9652e-05</td>
      <td>1.2587e-05</td>
      <td>-1.0920e-03</td>
      <td>9.6316e-03</td>
      <td>6.1442e-03</td>
      <td>-3.6007e-03</td>
      <td>-1.5285e-03</td>
      <td>0.1326</td>
      <td>3.9195e-03</td>
      <td>-2.2970e-03</td>
      <td>-9.7505e-04</td>
      <td>0.0846</td>
      <td>1.3461e-03</td>
      <td>5.7142e-04</td>
      <td>-0.0496</td>
      <td>2.4256e-04</td>
      <td>-0.0210</td>
      <td>1.8255</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>-0.0719</td>
      <td>-0.1007</td>
      <td>-2.4251</td>
      <td>-0.2656</td>
      <td>-2.8534</td>
      <td>-0.1751</td>
      <td>-0.1054</td>
      <td>-0.8761</td>
      <td>0.6658</td>
      <td>1.0</td>
      <td>0.0081</td>
      <td>0.2144</td>
      <td>0.0001</td>
      <td>0.0007</td>
      <td>0.0190</td>
      <td>0.0156</td>
      <td>-0.0133</td>
      <td>-0.0071</td>
      <td>0.5650</td>
      <td>5.1738e-03</td>
      <td>7.2464e-03</td>
      <td>0.1744</td>
      <td>1.9104e-02</td>
      <td>0.2052</td>
      <td>1.2597e-02</td>
      <td>7.5809e-03</td>
      <td>0.0630</td>
      <td>-4.7893e-02</td>
      <td>-1.4200e-02</td>
      <td>-5.8349e-04</td>
      <td>-1.5419e-02</td>
      <td>-8.7153e-06</td>
      <td>-5.1123e-05</td>
      <td>-1.3637e-03</td>
      <td>-1.1239e-03</td>
      <td>9.5460e-04</td>
      <td>5.0978e-04</td>
      <td>-0.0406</td>
      <td>0.0101</td>
      <td>0.2443</td>
      <td>0.0268</td>
      <td>0.2875</td>
      <td>0.0176</td>
      <td>0.0106</td>
      <td>0.0883</td>
      <td>-0.0671</td>
      <td>-0.0199</td>
      <td>-0.0008</td>
      <td>-0.0216</td>
      <td>...</td>
      <td>0.0037</td>
      <td>0.0031</td>
      <td>-0.0026</td>
      <td>-0.0014</td>
      <td>0.1115</td>
      <td>6.5806e-05</td>
      <td>1.7389e-03</td>
      <td>9.8290e-07</td>
      <td>5.7656e-06</td>
      <td>1.5379e-04</td>
      <td>1.2675e-04</td>
      <td>-1.0766e-04</td>
      <td>-5.7493e-05</td>
      <td>0.0046</td>
      <td>0.0460</td>
      <td>2.5973e-05</td>
      <td>1.5236e-04</td>
      <td>0.0041</td>
      <td>3.3493e-03</td>
      <td>-0.0028</td>
      <td>-1.5193e-03</td>
      <td>0.1211</td>
      <td>1.4681e-08</td>
      <td>8.6118e-08</td>
      <td>2.2971e-06</td>
      <td>1.8932e-06</td>
      <td>-1.6081e-06</td>
      <td>-8.5874e-07</td>
      <td>6.8457e-05</td>
      <td>5.0517e-07</td>
      <td>1.3475e-05</td>
      <td>1.1105e-05</td>
      <td>-9.4327e-06</td>
      <td>-5.0373e-06</td>
      <td>4.0156e-04</td>
      <td>3.5943e-04</td>
      <td>2.9622e-04</td>
      <td>-2.5161e-04</td>
      <td>-1.3437e-04</td>
      <td>0.0107</td>
      <td>2.4412e-04</td>
      <td>-2.0736e-04</td>
      <td>-1.1074e-04</td>
      <td>0.0088</td>
      <td>1.7613e-04</td>
      <td>9.4060e-05</td>
      <td>-0.0075</td>
      <td>5.0230e-05</td>
      <td>-0.0040</td>
      <td>0.3192</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>-0.0302</td>
      <td>-0.1082</td>
      <td>-1.5717</td>
      <td>-0.1600</td>
      <td>-1.4768</td>
      <td>-0.0822</td>
      <td>-0.0444</td>
      <td>-0.4286</td>
      <td>-1.3179</td>
      <td>0.0</td>
      <td>0.0013</td>
      <td>0.0650</td>
      <td>-0.0015</td>
      <td>0.0002</td>
      <td>0.0444</td>
      <td>0.0308</td>
      <td>-0.0170</td>
      <td>-0.0099</td>
      <td>0.4877</td>
      <td>9.1298e-04</td>
      <td>3.2708e-03</td>
      <td>0.0475</td>
      <td>4.8338e-03</td>
      <td>0.0446</td>
      <td>2.4830e-03</td>
      <td>1.3416e-03</td>
      <td>0.0130</td>
      <td>3.9822e-02</td>
      <td>-1.9476e-03</td>
      <td>-3.9487e-05</td>
      <td>-1.9652e-03</td>
      <td>4.4024e-05</td>
      <td>-5.3424e-06</td>
      <td>-1.3413e-03</td>
      <td>-9.2915e-04</td>
      <td>5.1426e-04</td>
      <td>2.9778e-04</td>
      <td>-0.0147</td>
      <td>0.0117</td>
      <td>0.1701</td>
      <td>0.0173</td>
      <td>0.1599</td>
      <td>0.0089</td>
      <td>0.0048</td>
      <td>0.0464</td>
      <td>0.1427</td>
      <td>-0.0070</td>
      <td>-0.0001</td>
      <td>-0.0070</td>
      <td>...</td>
      <td>0.0029</td>
      <td>0.0020</td>
      <td>-0.0011</td>
      <td>-0.0006</td>
      <td>0.0314</td>
      <td>1.7078e-06</td>
      <td>8.4993e-05</td>
      <td>-1.9040e-06</td>
      <td>2.3106e-07</td>
      <td>5.8012e-05</td>
      <td>4.0186e-05</td>
      <td>-2.2242e-05</td>
      <td>-1.2879e-05</td>
      <td>0.0006</td>
      <td>0.0042</td>
      <td>-9.4759e-05</td>
      <td>1.1499e-05</td>
      <td>0.0029</td>
      <td>2.0000e-03</td>
      <td>-0.0011</td>
      <td>-6.4096e-04</td>
      <td>0.0317</td>
      <td>2.1228e-06</td>
      <td>-2.5761e-07</td>
      <td>-6.4677e-05</td>
      <td>-4.4803e-05</td>
      <td>2.4797e-05</td>
      <td>1.4359e-05</td>
      <td>-7.1063e-04</td>
      <td>3.1262e-08</td>
      <td>7.8488e-06</td>
      <td>5.4370e-06</td>
      <td>-3.0093e-06</td>
      <td>-1.7425e-06</td>
      <td>8.6238e-05</td>
      <td>1.9706e-03</td>
      <td>1.3651e-03</td>
      <td>-7.5553e-04</td>
      <td>-4.3748e-04</td>
      <td>0.0217</td>
      <td>9.4561e-04</td>
      <td>-5.2337e-04</td>
      <td>-3.0305e-04</td>
      <td>0.0150</td>
      <td>2.8967e-04</td>
      <td>1.6773e-04</td>
      <td>-0.0083</td>
      <td>9.7124e-05</td>
      <td>-0.0048</td>
      <td>0.2379</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>0.0517</td>
      <td>-0.1091</td>
      <td>2.9763</td>
      <td>0.1733</td>
      <td>1.6769</td>
      <td>0.1172</td>
      <td>0.0758</td>
      <td>0.1352</td>
      <td>0.2544</td>
      <td>0.0</td>
      <td>-0.0033</td>
      <td>-0.0366</td>
      <td>-0.0026</td>
      <td>-0.0005</td>
      <td>-0.0083</td>
      <td>-0.0024</td>
      <td>-0.0061</td>
      <td>-0.0021</td>
      <td>0.4242</td>
      <td>2.6757e-03</td>
      <td>-5.6442e-03</td>
      <td>0.1540</td>
      <td>8.9650e-03</td>
      <td>0.0867</td>
      <td>6.0617e-03</td>
      <td>3.9204e-03</td>
      <td>0.0070</td>
      <td>1.3162e-02</td>
      <td>-6.1500e-03</td>
      <td>-1.7133e-04</td>
      <td>-1.8939e-03</td>
      <td>-1.3410e-04</td>
      <td>-2.6646e-05</td>
      <td>-4.2725e-04</td>
      <td>-1.2163e-04</td>
      <td>-3.1351e-04</td>
      <td>-1.0655e-04</td>
      <td>0.0219</td>
      <td>0.0119</td>
      <td>-0.3248</td>
      <td>-0.0189</td>
      <td>-0.1830</td>
      <td>-0.0128</td>
      <td>-0.0083</td>
      <td>-0.0148</td>
      <td>-0.0278</td>
      <td>0.0130</td>
      <td>0.0004</td>
      <td>0.0040</td>
      <td>...</td>
      <td>0.0010</td>
      <td>0.0003</td>
      <td>0.0007</td>
      <td>0.0002</td>
      <td>-0.0504</td>
      <td>1.0971e-05</td>
      <td>1.2127e-04</td>
      <td>8.5865e-06</td>
      <td>1.7062e-06</td>
      <td>2.7358e-05</td>
      <td>7.7883e-06</td>
      <td>2.0075e-05</td>
      <td>6.8228e-06</td>
      <td>-0.0014</td>
      <td>0.0013</td>
      <td>9.4914e-05</td>
      <td>1.8860e-05</td>
      <td>0.0003</td>
      <td>8.6090e-05</td>
      <td>0.0002</td>
      <td>7.5418e-05</td>
      <td>-0.0155</td>
      <td>6.7204e-06</td>
      <td>1.3354e-06</td>
      <td>2.1412e-05</td>
      <td>6.0957e-06</td>
      <td>1.5712e-05</td>
      <td>5.3400e-06</td>
      <td>-1.0997e-03</td>
      <td>2.6535e-07</td>
      <td>4.2547e-06</td>
      <td>1.2112e-06</td>
      <td>3.1221e-06</td>
      <td>1.0611e-06</td>
      <td>-2.1851e-04</td>
      <td>6.8222e-05</td>
      <td>1.9422e-05</td>
      <td>5.0061e-05</td>
      <td>1.7014e-05</td>
      <td>-0.0035</td>
      <td>5.5290e-06</td>
      <td>1.4251e-05</td>
      <td>4.8436e-06</td>
      <td>-0.0010</td>
      <td>3.6734e-05</td>
      <td>1.2485e-05</td>
      <td>-0.0026</td>
      <td>4.2431e-06</td>
      <td>-0.0009</td>
      <td>0.1799</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>0.0201</td>
      <td>-0.1092</td>
      <td>2.1535</td>
      <td>0.1381</td>
      <td>0.8461</td>
      <td>0.0457</td>
      <td>0.0284</td>
      <td>1.2717</td>
      <td>0.1560</td>
      <td>0.0</td>
      <td>-0.0093</td>
      <td>-0.1596</td>
      <td>-0.0039</td>
      <td>-0.0013</td>
      <td>-0.0741</td>
      <td>-0.0376</td>
      <td>0.0068</td>
      <td>0.0007</td>
      <td>-0.6113</td>
      <td>4.0534e-04</td>
      <td>-2.1983e-03</td>
      <td>0.0434</td>
      <td>2.7804e-03</td>
      <td>0.0170</td>
      <td>9.1963e-04</td>
      <td>5.7181e-04</td>
      <td>0.0256</td>
      <td>3.1404e-03</td>
      <td>-1.3188e-02</td>
      <td>-1.8663e-04</td>
      <td>-3.2124e-03</td>
      <td>-7.9125e-05</td>
      <td>-2.5252e-05</td>
      <td>-1.4909e-03</td>
      <td>-7.5793e-04</td>
      <td>1.3661e-04</td>
      <td>1.3497e-05</td>
      <td>-0.0123</td>
      <td>0.0119</td>
      <td>-0.2351</td>
      <td>-0.0151</td>
      <td>-0.0924</td>
      <td>-0.0050</td>
      <td>-0.0031</td>
      <td>-0.1389</td>
      <td>-0.0170</td>
      <td>0.0715</td>
      <td>0.0010</td>
      <td>0.0174</td>
      <td>...</td>
      <td>0.0485</td>
      <td>0.0247</td>
      <td>-0.0044</td>
      <td>-0.0004</td>
      <td>0.4004</td>
      <td>8.5934e-05</td>
      <td>1.4791e-03</td>
      <td>3.6433e-05</td>
      <td>1.1627e-05</td>
      <td>6.8645e-04</td>
      <td>3.4898e-04</td>
      <td>-6.2902e-05</td>
      <td>-6.2147e-06</td>
      <td>0.0057</td>
      <td>0.0255</td>
      <td>6.2708e-04</td>
      <td>2.0013e-04</td>
      <td>0.0118</td>
      <td>6.0068e-03</td>
      <td>-0.0011</td>
      <td>-1.0697e-04</td>
      <td>0.0975</td>
      <td>1.5446e-05</td>
      <td>4.9295e-06</td>
      <td>2.9103e-04</td>
      <td>1.4796e-04</td>
      <td>-2.6668e-05</td>
      <td>-2.6348e-06</td>
      <td>2.4024e-03</td>
      <td>1.5732e-06</td>
      <td>9.2880e-05</td>
      <td>4.7219e-05</td>
      <td>-8.5109e-06</td>
      <td>-8.4088e-07</td>
      <td>7.6673e-04</td>
      <td>5.4834e-03</td>
      <td>2.7877e-03</td>
      <td>-5.0247e-04</td>
      <td>-4.9644e-05</td>
      <td>0.0453</td>
      <td>1.4173e-03</td>
      <td>-2.5545e-04</td>
      <td>-2.5238e-05</td>
      <td>0.0230</td>
      <td>4.6043e-05</td>
      <td>4.5490e-06</td>
      <td>-0.0041</td>
      <td>4.4944e-07</td>
      <td>-0.0004</td>
      <td>0.3737</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 210 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="mi">320000</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">target_col</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">trn</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">320000</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">tst</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">320000</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span>
<span class="n">feature_name</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">trn</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">tst</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(320000,) (320000, 209) (80000, 209)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="stratified-k-fold-cross-validation">
<h2>Stratified K-Fold Cross Validation<a class="headerlink" href="#stratified-k-fold-cross-validation" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="n">n_fold</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="keras-model">
<h2>Keras Model<a class="headerlink" href="#keras-model" title="Permalink to this headline">¶</a></h2>
<div class="section" id="sequential-api">
<h3>Sequential API<a class="headerlink" href="#sequential-api" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_model</span><span class="p">():</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>

    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">n_class</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;softmax&#39;</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;categorical_crossentropy&#39;</span><span class="p">,</span>
                  <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="functional-api">
<h3>Functional API<a class="headerlink" href="#functional-api" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_model</span><span class="p">():</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feature_name</span><span class="p">),))</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">inputs</span><span class="p">)</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">n_class</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;softmax&#39;</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;categorical_crossentropy&#39;</span><span class="p">,</span>
                  <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="id3">
<h2>신경망 모델 학습<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">trn</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n_class</span><span class="p">))</span>
<span class="n">p_tst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">tst</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n_class</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">i_trn</span><span class="p">,</span> <span class="n">i_val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">trn</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;training model for CV #</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">clf</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">()</span>
    
    <span class="n">es</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">min_delta</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                       <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">baseline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">rlr</span> <span class="o">=</span> <span class="n">ReduceLROnPlateau</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                            <span class="n">patience</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_lr</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trn</span><span class="p">[</span><span class="n">i_trn</span><span class="p">],</span> 
            <span class="n">to_categorical</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i_trn</span><span class="p">]),</span>
            <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">trn</span><span class="p">[</span><span class="n">i_val</span><span class="p">],</span> <span class="n">to_categorical</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i_val</span><span class="p">])),</span>
            <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">es</span><span class="p">,</span> <span class="n">rlr</span><span class="p">])</span>
    <span class="n">p_val</span><span class="p">[</span><span class="n">i_val</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">trn</span><span class="p">[</span><span class="n">i_val</span><span class="p">])</span>
    <span class="n">p_tst</span> <span class="o">+=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">tst</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_fold</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>training model for CV #1
Epoch 1/10
8000/8000 [==============================] - 6s 691us/step - loss: 11.6517 - val_loss: 0.3027
Epoch 2/10
8000/8000 [==============================] - 5s 603us/step - loss: 1.4335 - val_loss: 0.2639
Epoch 3/10
8000/8000 [==============================] - 5s 604us/step - loss: 0.2691 - val_loss: 0.2678
Epoch 4/10
8000/8000 [==============================] - 5s 621us/step - loss: 1.4684 - val_loss: 0.2482
Epoch 5/10
8000/8000 [==============================] - 5s 594us/step - loss: 0.4254 - val_loss: 0.2944
Epoch 6/10
8000/8000 [==============================] - 5s 643us/step - loss: 0.2451 - val_loss: 0.2431
Epoch 7/10
8000/8000 [==============================] - 5s 674us/step - loss: 2.2416 - val_loss: 0.2343
Epoch 8/10
8000/8000 [==============================] - 5s 653us/step - loss: 0.2418 - val_loss: 0.2345
Epoch 9/10
8000/8000 [==============================] - 5s 631us/step - loss: 0.2449 - val_loss: 0.2294
Epoch 10/10
8000/8000 [==============================] - 5s 641us/step - loss: 4.3611 - val_loss: 0.2274
training model for CV #2
Epoch 1/10
8000/8000 [==============================] - 5s 650us/step - loss: 26.2863 - val_loss: 0.2878
Epoch 2/10
8000/8000 [==============================] - 5s 640us/step - loss: 7.0914 - val_loss: 5.9831
Epoch 3/10
8000/8000 [==============================] - 5s 680us/step - loss: 0.2641 - val_loss: 9.2831
Epoch 4/10
7941/8000 [============================&gt;.] - ETA: 0s - loss: 0.7149
Epoch 00004: ReduceLROnPlateau reducing learning rate to 0.0005000000237487257.
8000/8000 [==============================] - 5s 658us/step - loss: 0.7113 - val_loss: 14.3258
Epoch 5/10
8000/8000 [==============================] - 5s 659us/step - loss: 0.2424 - val_loss: 17.0050
Epoch 6/10
7960/8000 [============================&gt;.] - ETA: 0s - loss: 0.2377Restoring model weights from the end of the best epoch.
8000/8000 [==============================] - 5s 623us/step - loss: 0.2376 - val_loss: 18.2475
Epoch 00006: early stopping
training model for CV #3
Epoch 1/10
8000/8000 [==============================] - 5s 670us/step - loss: 16.6418 - val_loss: 0.2737
Epoch 2/10
8000/8000 [==============================] - 5s 637us/step - loss: 4.4442 - val_loss: 0.2609
Epoch 3/10
8000/8000 [==============================] - 5s 597us/step - loss: 0.3640 - val_loss: 0.2484
Epoch 4/10
8000/8000 [==============================] - 5s 618us/step - loss: 0.2563 - val_loss: 0.2314
Epoch 5/10
8000/8000 [==============================] - 5s 596us/step - loss: 0.2565 - val_loss: 0.2314
Epoch 6/10
8000/8000 [==============================] - 5s 597us/step - loss: 0.4754 - val_loss: 0.2374
Epoch 7/10
7959/8000 [============================&gt;.] - ETA: 0s - loss: 0.8006
Epoch 00007: ReduceLROnPlateau reducing learning rate to 0.0005000000237487257.
8000/8000 [==============================] - 5s 596us/step - loss: 0.7975 - val_loss: 0.2322
Epoch 8/10
8000/8000 [==============================] - 5s 598us/step - loss: 0.2830 - val_loss: 0.2204
Epoch 9/10
8000/8000 [==============================] - 5s 620us/step - loss: 0.2286 - val_loss: 0.2141
Epoch 10/10
8000/8000 [==============================] - 5s 677us/step - loss: 0.4495 - val_loss: 0.2163
training model for CV #4
Epoch 1/10
8000/8000 [==============================] - 6s 720us/step - loss: 12.5209 - val_loss: 104.1083
Epoch 2/10
8000/8000 [==============================] - 5s 600us/step - loss: 7.3628 - val_loss: 47.8241
Epoch 3/10
8000/8000 [==============================] - 5s 588us/step - loss: 3.8502 - val_loss: 32.1715
Epoch 4/10
8000/8000 [==============================] - 5s 645us/step - loss: 1.4737 - val_loss: 21.5491
Epoch 5/10
8000/8000 [==============================] - 5s 646us/step - loss: 1.8249 - val_loss: 23.6221
Epoch 6/10
8000/8000 [==============================] - 5s 629us/step - loss: 0.2341 - val_loss: 23.6290
Epoch 7/10
8000/8000 [==============================] - 5s 685us/step - loss: 0.2341 - val_loss: 21.0535
Epoch 8/10
8000/8000 [==============================] - 5s 663us/step - loss: 0.2381 - val_loss: 24.0096
Epoch 9/10
8000/8000 [==============================] - 5s 633us/step - loss: 0.2232 - val_loss: 25.9969
Epoch 10/10
7918/8000 [============================&gt;.] - ETA: 0s - loss: 0.2201
Epoch 00010: ReduceLROnPlateau reducing learning rate to 0.0005000000237487257.
8000/8000 [==============================] - 5s 641us/step - loss: 0.2200 - val_loss: 26.4051
training model for CV #5
Epoch 1/10
8000/8000 [==============================] - 5s 630us/step - loss: 28.4105 - val_loss: 9.3231
Epoch 2/10
8000/8000 [==============================] - 5s 669us/step - loss: 9.5780 - val_loss: 4.7251
Epoch 3/10
8000/8000 [==============================] - 5s 654us/step - loss: 5.6948 - val_loss: 0.2427
Epoch 4/10
8000/8000 [==============================] - 5s 671us/step - loss: 0.2686 - val_loss: 0.2458
Epoch 5/10
8000/8000 [==============================] - 5s 636us/step - loss: 1.5572 - val_loss: 0.2441
Epoch 6/10
8000/8000 [==============================] - 5s 659us/step - loss: 0.6911 - val_loss: 0.2274
Epoch 7/10
8000/8000 [==============================] - 5s 627us/step - loss: 0.2479 - val_loss: 0.2302
Epoch 8/10
8000/8000 [==============================] - 5s 664us/step - loss: 1.1990 - val_loss: 0.2404
Epoch 9/10
7989/8000 [============================&gt;.] - ETA: 0s - loss: 0.2406
Epoch 00009: ReduceLROnPlateau reducing learning rate to 0.0005000000237487257.
8000/8000 [==============================] - 5s 648us/step - loss: 0.2405 - val_loss: 0.2336
Epoch 10/10
8000/8000 [==============================] - 5s 634us/step - loss: 0.2212 - val_loss: 0.2235
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">p_val</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>91.5106%
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">p_val</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">p_tst</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(320000, 3) (80000, 3)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">p_val_file</span><span class="p">,</span> <span class="n">p_val</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.6f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">p_tst_file</span><span class="p">,</span> <span class="n">p_tst</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.6f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id4">
<h2>신경망 모델 시각화<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clf</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model: &quot;functional_9&quot;
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
input_5 (InputLayer)         [(None, 209)]             0         
_________________________________________________________________
dense_10 (Dense)             (None, 64)                13440     
_________________________________________________________________
dense_11 (Dense)             (None, 3)                 195       
=================================================================
Total params: 13,635
Trainable params: 13,635
Non-trainable params: 0
_________________________________________________________________
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_model</span><span class="p">(</span><span class="n">clf</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">25</span><span class="o">-</span><span class="n">e41951ebbf56</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">plot_model</span><span class="p">(</span><span class="n">clf</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;plot_model&#39; is not defined
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id5">
<h2>제출 파일 생성<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sub</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">sample_file</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sub</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">sub</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sub</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">p_tst</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sub</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sub</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sub</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">sub_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./lectures"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="11-categorical-features.html" title="previous page">범주형변수 가공 데모</a>
    <a class='right-next' id="next-link" href="13-lr-tfidf.html" title="next page">데모</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Kaggler-TV<br/>
        
            &copy; Copyright 2020-2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>